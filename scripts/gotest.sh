#!/bin/sh
set -e

# run all unit tests
gotest="go test -short -cover"

$gotest ./api/...
$gotest ./catalog/...
$gotest ./pkg/db/...
$gotest ./pkg/utils/...
$gotest ./pkg/containersvc/...
$gotest ./pkg/dns/...
$gotest ./pkg/managesvc/...
$gotest ./pkg/log/...

# docker volume and server unit tests use loop device, root permission is required.
sudo -E $gotest ./pkg/plugins/...

# to exclude ec2 test, switch to run server unit test only
sudo -E $gotest ./pkg/server/...
#cd server; sudo -E go test; cd -
